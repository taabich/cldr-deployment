
DO $$
DECLARE
    r RECORD;
BEGIN
    -- Rename all tables (exclude views) to uppercase
    FOR r IN
        SELECT tablename
        FROM pg_tables
        WHERE schemaname = 'public'
          AND tablename <> upper(tablename)
          AND upper(tablename) NOT IN (
              SELECT upper(table_name) FROM information_schema.views WHERE table_schema = 'public'
          )
    LOOP
        EXECUTE format(
            'ALTER TABLE public.%I RENAME TO "%s"',
            r.tablename,
            upper(r.tablename)
        );
    END LOOP;

    -- Rename all columns to uppercase, for real tables only (exclude views)
    FOR r IN
        SELECT c.table_name, c.column_name
        FROM information_schema.columns c
        WHERE c.table_schema = 'public'
          AND upper(c.table_name) NOT IN (
              SELECT upper(table_name) FROM information_schema.views WHERE table_schema = 'public'
          )
    LOOP
        EXECUTE format(
            'ALTER TABLE public."%s" RENAME COLUMN %I TO "%s"',
            upper(r.table_name),
            r.column_name,
            upper(r.column_name)
        );
    END LOOP;
END $$;
