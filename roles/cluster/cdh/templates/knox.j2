
{% set service_dependencies = {
  'RANGER': 'ranger'
} %}
{
  "refName": "knox",
  "serviceType": "KNOX",
  "displayName": "KNOX",
  "serviceConfigs": [
    {
      "name": "knox_encryptquerystring_secret",
      "value": "{{ knox_encryptquerystring_secret }}"
    },
    {
      "name": "knox_hadoop_auth_config_signature_secret",
      "value": "{{ knox_hadoop_auth_config_signature_secret }}"
    },
    {
      "name": "conf/gateway-site.xml_service_safety_valve",
      "value": "<property><name>knox.homepage.logout.enabled</name><value>true</value></property>"
    },
    {
      "name": "knox_homepage_hidden_topologies",
      "value": "manager,knoxsso,homepage"
    },
    {
      "name": "knox_homepage_profile",
      "value": "full"
    },
    {
      "name": "kerberos.auth.enabled",
      "value": "false"
    },
    {% for svc, ref in service_dependencies.items() if svc in enabled_services %}
        {
          "name": "{{ svc|lower() }}_service",
          "ref": "{{ ref }}"
        }{% if not loop.last %},{% endif %}
    {% endfor %}

  ],
  "roleConfigGroups": [
    {
      "refName": "knox-KNOX_GATEWAY-BASE",
      "roleType": "KNOX_GATEWAY",
      "configs": [
      {
        "name": "gateway_knox_admin_groups",
        "value": "{{ hdfs_supergroup }}"
      },
      {
        "name": "gateway_master_secret",
        "value": "{{ gateway_master_secret }}"
      },
      {
        "name": "gateway_heap_size",
        "value": "{{ gateway_heap_size | default('1024') }}"
      }
      ],
      "base": true
    },
     {
      "refName": "knox-GATEWAY-BASE",
      "roleType": "GATEWAY",
      "base": true
    }
       
  ]
}