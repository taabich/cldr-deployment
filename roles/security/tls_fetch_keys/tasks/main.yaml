

- fail:
    msg: local_keys_dir not defined
  when: local_keys_dir is undefined or local_keys_dir == ""

- name: Check if file {{local_keys_dir}} exists
  local_action: stat path={{ local_keys_dir }}
  register: local_src_check
  run_once: true

- file:
    path: "{{ local_keys_dir }}" 
    state: directory
  when: not local_src_check.stat.exists
  run_once: true





- name: Bring Keys back to controller
  become: true
  fetch:
    src: "{{  tls_key_path_plaintext }}"
    dest: "{{ local_keys_dir }}/{{ ansible_fqdn }}.key"
    flat: yes
